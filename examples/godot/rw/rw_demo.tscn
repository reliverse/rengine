[gd_scene load_steps=2 format=3 uid="uid://cr7q5mh6aj7ie"]

[sub_resource type="GDScript" id="1"]
script/source = "
extends Node

@onready var rw_analyzer = $RwAnalyzer
@onready var output_label = $UI/VBoxContainer/OutputLabel

func _ready():
	# Connect button signals
	$UI/VBoxContainer/AnalyzeFileButton.connect(\"pressed\", Callable(self, \"_on_analyze_file_pressed\"))
	$UI/VBoxContainer/ParseImgButton.connect(\"pressed\", Callable(self, \"_on_parse_img_pressed\"))
	$UI/VBoxContainer/ParseDffButton.connect(\"pressed\", Callable(self, \"_on_parse_dff_pressed\"))
	$UI/VBoxContainer/ClearButton.connect(\"pressed\", Callable(self, \"_on_clear_pressed\"))

func _on_analyze_file_pressed():
	var dialog = FileDialog.new()
	dialog.file_mode = FileDialog.FILE_MODE_OPEN_FILE
	dialog.access = FileDialog.ACCESS_FILESYSTEM
	dialog.connect(\"file_selected\", Callable(self, \"_on_file_selected_for_analysis\"))
	add_child(dialog)
	dialog.popup_centered()

func _on_file_selected_for_analysis(path: String):
	var result = rw_analyzer.analyze_file(path)
	output_label.text = \"File Analysis:\\n\" + JSON.stringify(result, \"  \")

func _on_parse_img_pressed():
	var dialog = FileDialog.new()
	dialog.file_mode = FileDialog.FILE_MODE_OPEN_FILE
	dialog.access = FileDialog.ACCESS_FILESYSTEM
	dialog.filters = PackedStringArray([\"*.img ; IMG Archive Files\"])
	dialog.connect(\"file_selected\", Callable(self, \"_on_img_file_selected\"))
	add_child(dialog)
	dialog.popup_centered()

func _on_img_file_selected(path: String):
	var result = rw_analyzer.parse_img_archive(path)
	output_label.text = \"IMG Archive:\\n\" + JSON.stringify(result, \"  \")

func _on_parse_dff_pressed():
	var dialog = FileDialog.new()
	dialog.file_mode = FileDialog.FILE_MODE_OPEN_FILE
	dialog.access = FileDialog.ACCESS_FILESYSTEM
	dialog.filters = PackedStringArray([\"*.dff ; DFF Model Files\"])
	dialog.connect(\"file_selected\", Callable(self, \"_on_dff_file_selected\"))
	add_child(dialog)
	dialog.popup_centered()

func _on_dff_file_selected(path: String):
	var result = rw_analyzer.parse_dff_model(path)
	output_label.text = \"DFF Model:\\n\" + JSON.stringify(result, \"  \")

func _on_clear_pressed():
	output_label.text = \"Select a file to analyze...\"
"

[node name="RwDemo" type="Node"]
script = SubResource("1")

[node name="RwAnalyzer" type="RwAnalyzer" parent="."]

[node name="UI" type="CanvasLayer" parent="."]

[node name="VBoxContainer" type="VBoxContainer" parent="UI"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="TitleLabel" type="Label" parent="UI/VBoxContainer"]
layout_mode = 2
text = "Rengine RenderWare Parser Demo"
horizontal_alignment = 1

[node name="AnalyzeFileButton" type="Button" parent="UI/VBoxContainer"]
layout_mode = 2
text = "Analyze Any File"

[node name="ParseImgButton" type="Button" parent="UI/VBoxContainer"]
layout_mode = 2
text = "Parse IMG Archive"

[node name="ParseDffButton" type="Button" parent="UI/VBoxContainer"]
layout_mode = 2
text = "Parse DFF Model"

[node name="ClearButton" type="Button" parent="UI/VBoxContainer"]
layout_mode = 2
text = "Clear Output"

[node name="OutputLabel" type="Label" parent="UI/VBoxContainer"]
custom_minimum_size = Vector2(0, 100)
layout_mode = 2
size_flags_vertical = 3
text = "Select a file to analyze..."
autowrap_mode = 2
